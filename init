#!/bin/ash
# init script to start ddclient

# exit at failure with '1'!
set -e
# exit if environment variables were not defined
set -u

# replace credentials when starting container first time
if [ ! -f /.initialized ]; then
    sed -i -e "s/@@login@@/${LOGIN:-HOSTNAME}/g" /etc/ddclient/ddclient.conf
    sed -i -e "s/@@password@@/${PASSWORD:-UPDATE_TOKEN}/g" /etc/ddclient/ddclient.conf
    sed -i -e "s/@@hostname@@/$HOSTNAME/g" /etc/ddclient/ddclient.conf
    touch /.initialized
fi

# start ddclient
ddclient -daemon=300 -foreground -noquiet
